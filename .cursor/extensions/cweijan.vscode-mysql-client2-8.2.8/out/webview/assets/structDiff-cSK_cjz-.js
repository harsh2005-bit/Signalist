import{Fragment as e,computed as t,createBaseVNode as n,createBlock as r,createCommentVNode as i,createElementBlock as a,createTextVNode as o,createVNode as s,defineComponent as c,handler as l,onMounted as u,openBlock as d,reactive as f,ref as p,renderList as m,resolveComponent as h,toDisplayString as g,withCtx as _}from"./vscode-ByQLBi_r.js";import{ElForm as v,ElFormItem as y}from"./focus-trap-CSSWZImT.js";import{error as b,success as x}from"./notify-Bq8ZgKm0.js";import"./tooltip-CVpAU6Sv.js";import"./isEqual-CdOvZtUE.js";import{ElOption as S,ElSelect as C}from"./select-C503yUaE.js";import"./_baseFindIndex-Be7HZc5f.js";import"./isArrayLikeObject-05TlFTR_.js";import"./merge-DTOcvLG1.js";import"./_baseIteratee-CSRzNRlS.js";import{ElTable as w,ElTableColumn as T}from"./table-RpKCEj1I.js";import"./isUndefined-Cqoojwy1.js";import"./use-empty-values-Dsd09Jyu.js";import"./click-outside-auYYsqs3.js";import"./checkbox-BaDld0em.js";import"./tag-CWpNjs-a.js";const E={class:`opt-panel`},D=[`src`],O={class:`opt-panel`},k=[`src`],A={key:0,class:`bg-secondBg pl-5 pt-3`},j={class:`mb-3`};var M=c({__name:`structDiff`,setup(c){let M=p([{value:`MySQL`,icon:`resources/icon/server/mysql_dark.svg`},{value:`MariaDB`,icon:`resources/icon/server/mariadb.svg`},{value:`PostgreSQL`,icon:`resources/icon/server/pgsql.svg`}]),N=p(null),P=p([]),F=f({dbLoading:!1,dbList:[]}),I=f({dbLoading:!1,dbList:[]}),L=f({from:{connection:null,database:null,db:null},to:{connection:null,database:null,db:null}}),R=f({compare:!1,sync:!1}),z=f({sqlList:null}),B=t(()=>window.outerHeight-340);u(()=>{l.on(`nodes`,e=>{P.value=e}).on(`sourceDB`,e=>{F.dbList=e,F.dbLoading=!1}).on(`targetDB`,e=>{I.dbList=e,I.dbLoading=!1}).on(`compareResult`,e=>{e.sqlList=e,R.compare=!1}).on(`syncSuccess`,()=>{x(`syncSuccess`),R.sync=!1}).on(`success`,()=>{J()}).on(`error`,e=>{b(e),R.sync=!1}).init()});let V=e=>{for(let t of M.value)if(t.value==e)return t.icon;return`icon/server/mysql_dark.svg`},H=e=>{l.emit(`loadDB`,{key:e}),F.dbLoading=!0,F.dbList=[],L.from.db=null,L.from.database=null},U=e=>{l.emit(`loadDB`,{key:e,isTarget:!0}),I.dbLoading=!0,I.dbList=[],L.to.db=null,L.to.database=null},W=(e,t)=>{let n=t?F.dbList:I.dbList;for(let r of n)r.label==e&&(t?L.from.db=r:L.to.db=r)},G=()=>{R.compare=!0,l.emit(`start`,L)},K=()=>{let e=N.value.getCheckboxRecords();if(!e||e.length==0){b(`Need to select at least one sql!`);return}R.sync=!0,l.emit(`sync`,{sqlList:e,option:L})},q=e=>{console.log(`selectionChange`,e)},J=()=>{l.emit(`init`)};return(t,c)=>{let l=S,u=C,f=y,p=v,b=h(`vsc-button`),x=T,M=w;return d(),a(`div`,null,[c[8]||=n(`div`,{style:{margin:`30px 20px`}},` Structure sync is being refactored and is currently unavailable `,-1),n(`div`,E,[s(p,null,{default:_(()=>[s(f,{"label-width":`80px`,label:`Target`},{default:_(()=>[s(u,{modelValue:L.from.connection,"onUpdate:modelValue":c[0]||=e=>L.from.connection=e,filterable:``,onChange:H},{default:_(()=>[(d(!0),a(e,null,m(P.value,e=>(d(),r(l,{key:e.key,label:e.label,value:e.key},{default:_(()=>[n(`img`,{src:V(e.dbType),class:`inline-block`,style:{width:`13px`,height:`13px`,position:`relative`,left:`-2px`,top:`-1px`}},null,8,D),o(` `+g(e.label),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(f,{"label-width":`80px`,label:`database`},{default:_(()=>[s(u,{modelValue:L.from.database,"onUpdate:modelValue":c[1]||=e=>L.from.database=e,loading:F.dbLoading,filterable:``,onChange:c[2]||=e=>W(e,!0)},{default:_(()=>[(d(!0),a(e,null,m(F.dbList,e=>(d(),r(l,{key:e.label,label:e.label,value:e.label},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`])]),_:1})]),_:1})]),n(`div`,O,[s(p,null,{default:_(()=>[s(f,{"label-width":`90px`,label:`Sync From`},{default:_(()=>[s(u,{modelValue:L.to.connection,"onUpdate:modelValue":c[3]||=e=>L.to.connection=e,filterable:``,onChange:U},{default:_(()=>[(d(!0),a(e,null,m(P.value,e=>(d(),r(l,{key:e.key,label:e.label,value:e.key},{default:_(()=>[n(`img`,{src:V(e.dbType),class:`inline-block`,style:{width:`13px`,height:`13px`,position:`relative`,left:`-2px`,top:`-1px`}},null,8,k),o(` `+g(e.label),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(f,{"label-width":`90px`,label:`database`},{default:_(()=>[s(u,{modelValue:L.to.database,"onUpdate:modelValue":c[4]||=e=>L.to.database=e,loading:I.dbLoading,filterable:``,onChange:c[5]||=e=>W(e,!1)},{default:_(()=>[(d(!0),a(e,null,m(I.dbList,e=>(d(),r(l,{key:e.label,label:e.label,value:e.label},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`])]),_:1})]),_:1})]),s(b,{style:{"margin-left":`250px`},class:`m-2`,loading:R.compare,title:`Start Compare`,onClick:G},{default:_(()=>c[6]||=[o(` Compare `)]),_:1},8,[`loading`]),n(`div`,null,[z.sqlList?(d(),a(`div`,A,[n(`div`,j,[s(b,{loading:R.sync,title:`Confrim Sync`,onClick:K},{default:_(()=>c[7]||=[o(` Sync `)]),_:1},8,[`loading`])]),s(M,{ref_key:`dataTable`,ref:N,data:z.sqlList,height:B.value,style:{width:`100%`},onSelectionChange:q},{default:_(()=>[s(x,{type:`checkbox`,width:`40`,fixed:`left`}),s(x,{align:`center`,width:`60`,field:`type`,label:`type`}),s(x,{align:`center`,field:`sql`,label:`sql`})]),_:1},8,[`data`,`height`])])):i(``,!0)])])}}}),N=M;export{N as default};