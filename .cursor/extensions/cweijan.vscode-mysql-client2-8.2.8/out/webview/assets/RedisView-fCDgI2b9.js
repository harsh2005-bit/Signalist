import{Fragment as e,computed as t,createBaseVNode as n,createBlock as r,createCommentVNode as i,createElementBlock as a,createTextVNode as o,createVNode as s,defineComponent as c,handler as l,isCompose as u,normalizeStyle as d,onBeforeMount as f,openBlock as p,ref as m,renderList as h,resolveComponent as g,toDisplayString as _,unref as v,withCtx as y,withDirectives as b}from"./vscode-ByQLBi_r.js";import{ElForm as x,ElFormItem as S,vShow as C,withKeys as w}from"./focus-trap-CSSWZImT.js";import{defineStore as T,storeToRefs as E}from"./pinia-BVG5H93L.js";import{$t as D,ElInput as O,confirmEl as k,error as A,success as j}from"./notify-Bq8ZgKm0.js";import{__plugin_vue_export_helper_default as M}from"./_plugin-vue_export-helper-C32SG5g-.js";import"./tooltip-CVpAU6Sv.js";import"./isEqual-CdOvZtUE.js";import{ElOption as N,ElSelect as P}from"./select-C503yUaE.js";import"./_baseFindIndex-Be7HZc5f.js";import"./isArrayLikeObject-05TlFTR_.js";import"./merge-DTOcvLG1.js";import"./_baseIteratee-CSRzNRlS.js";import{ElTable as F,ElTableColumn as I}from"./table-RpKCEj1I.js";import"./isUndefined-Cqoojwy1.js";import{ElDialog as L}from"./dialog-DAyTdGY9.js";import"./use-empty-values-Dsd09Jyu.js";import"./click-outside-auYYsqs3.js";import"./checkbox-BaDld0em.js";import"./tag-CWpNjs-a.js";import{ElPagination as R,useDialogStore as z}from"./dialogStore-BuqWpYbl.js";import{RedisType as B}from"./constants-AMjnVokj.js";import{copyContent as V,listenHeight as H,parse as U,stringify as W}from"./common_view_utils-CfTC2dmq.js";import{deepClone as G}from"./objectUtil-BEldwiwk.js";import{codemirror_default as K,supportedLanguages as q}from"./codemirror-QBTlYVWA.js";const J=T(`redis`,{state:()=>({stack:!1,remainHeight:0,edit:{name:``,ttl:-1,content:null},key:{name:``,ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(e){if(e!=null&&(this.itemModel.value=e),!this.edit.name)return A(`Key name cannot be null!`);l.emit(`saveItem`,{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),Y={id:`panel`,class:`flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3`},X={key:1,class:`key-label key-detail-type`};var Z=c({__name:`RedisKeyInfo`,setup(e){let t=m(!1),o=J(),{key:c,edit:u}=E(o),d=()=>{k(D(`confirm.deleteRedisKey`)).then(()=>{l.emit(`del`,{key:{name:o.key.name}}),o.key={},o.edit={}})},f=()=>{l.emit(`rename`,{key:{name:o.key.name,newName:o.edit.name}})},h=()=>{l.emit(`ttl`,{key:{name:o.key.name,ttl:o.edit.ttl}})};return l.on(`new`,()=>{t.value=!0}),l.on(`detail`,()=>{t.value=!1}),setInterval(()=>{document.activeElement.tagName!==`INPUT`&&u.value.ttl>0&&--u.value.ttl},1e3),(e,l)=>{let m=N,b=P,x=O,S=g(`vsc-button`),C=g(`vsc-tooltip`);return p(),a(`div`,Y,[n(`div`,null,[s(x,{ref:`keyNameInput`,modelValue:v(u).name,"onUpdate:modelValue":l[1]||=e=>v(u).name=e,size:`small`,placeholder:`Please input key name`,style:{width:`500px`},onKeyup:w(f,[`enter`])},{prepend:y(()=>[t.value?(p(),r(b,{key:0,modelValue:v(c).type,"onUpdate:modelValue":l[0]||=e=>v(c).type=e,placeholder:`Forever`,size:`small`,style:{width:`100px`}},{default:y(()=>[s(m,{value:`string`,label:`STRING`}),v(o).stack?(p(),r(m,{key:0,value:`ReJSON-RL`,label:`ReJSON-RL`})):i(``,!0),s(m,{value:`list`,label:`LIST`}),s(m,{value:`set`,label:`SET`}),s(m,{value:`zset`,label:`ZSET`}),s(m,{value:`hash`,label:`HASH`}),s(m,{value:`stream`,label:`STREAM`})]),_:1},8,[`modelValue`])):(p(),a(`span`,X,_(v(c).type),1))]),_:1},8,[`modelValue`]),s(C,{title:v(D)(`result.copy`),placement:`top`},{default:y(()=>[s(S,{class:`ml-1`,size:`mini`,icon:`el-icon-document-copy`,onClick:l[2]||=e=>v(V)(v(u).name)})]),_:1},8,[`title`])]),n(`div`,null,[s(x,{modelValue:v(u).ttl,"onUpdate:modelValue":l[3]||=e=>v(u).ttl=e,size:`small`,class:`mr-1`,style:{width:`220px`},onKeyup:w(h,[`enter`])},{prepend:y(()=>l[4]||=[n(`span`,{class:`key-label`},`TTL`,-1)]),_:1},8,[`modelValue`]),s(S,{icon:`codicon codicon-save`,size:`mini`,onClick:h}),s(S,{icon:`el-icon-delete`,size:`mini`,type:`secondary`,onClick:d})])])}}}),Q=M(Z,[[`__scopeId`,`data-v-ae794ec1`]]);const $={key:0},ee={id:`listPanel`},te=[`title`,`textContent`];var ne=c({__name:`RedisListView`,setup(e){let c=J(),{key:u,itemModel:d,remainHeight:f}=E(c),h=m(``),b=m(``),C=m(1),w=m(100),T=m(0),A=m(!1);l.on(`detail`,e=>{A.value=!1,C.value=e.page.pageNum,w.value=e.page.pageSize}).on(`pagination`,e=>{c.key.content=e}).on(`success`,()=>{A.value=!1});let M=t(()=>{let e=c.itemModel.old,t=u.value.type;return t=t.charAt(0).toUpperCase()+t.slice(1),`${e?`Edit`:`Add to`} ${t}`}),N=t(()=>{let e=u.value.type;switch(e){case`list`:return`Element`;case`hash`:return`Value`;case`set`:case`zset`:return`Member`;case`stream`:return`Entry`;default:return e.charAt(0).toUpperCase()+e.slice(1)}}),P=(e,t)=>{l.emit(`changePage`,t?e:C.value+e)},z=()=>{A.value=!0,c.itemModel={old:null,key:null,index:null,score:null,value:null}},B=t(()=>{u.value.content||(u.value.content=[]);let e=h.value,t=b.value,n=u.value.content.filter(n=>{if(e&&u.value.type==`hash`&&!`${n.key}`.match(new RegExp(e,`i`)))return!1;if(t){let e=`${n.value??n}`;if(!e.match(new RegExp(t,`i`)))return!1}return!0});return T.value=u.value.count??n.length,n}),V=e=>{k(D(`confirm.deleteRedisKey`)).then(()=>{l.emit(`deleteLine`,e)})},H=e=>{navigator.clipboard.writeText(e.value??e),j(D(`common.copied`))},U=e=>{c.itemModel={...e,old:{...e}},A.value=!0};return(e,t)=>{let m=O,E=g(`vsc-button`),k=g(`vsc-tooltip`),j=R,W=S,G=x,K=L,q=I,J=F;return[`list`,`hash`,`set`,`zset`,`stream`].includes(v(u).type)?(p(),a(`div`,$,[n(`div`,ee,[v(u).type==`hash`?(p(),r(m,{key:0,modelValue:h.value,"onUpdate:modelValue":t[0]||=e=>h.value=e,class:`filter-input mb-2 mr-2`,size:`small`,style:{width:`120px`},placeholder:v(D)(`result.searchField`),clearable:!0},null,8,[`modelValue`,`placeholder`])):i(``,!0),s(m,{modelValue:b.value,"onUpdate:modelValue":t[1]||=e=>b.value=e,class:`filter-input mb-2`,size:`small`,style:{width:`200px`},placeholder:v(D)(`result.searchNotice`),clearable:!0},null,8,[`modelValue`,`placeholder`]),s(k,{title:v(D)(`common.refresh`),placement:`top`},{default:y(()=>[s(E,{type:`icon`,icon:`codicon-refresh text-lg`,class:`ml-2`,onClick:t[2]||=e=>{v(l).emit(`refresh`)}})]),_:1},8,[`title`]),s(k,{title:`Add new key`},{default:y(()=>[v(u).type==`stream`?i(``,!0):(p(),r(E,{key:0,type:`icon`,icon:`codicon-add text-lg`,class:`inline-block !ml-1`,style:{color:`var(--vscode-terminal-ansiYellow)`},onClick:t[3]||=e=>z()}))]),_:1}),s(j,{"page-size":w.value,"onUpdate:pageSize":t[4]||=e=>w.value=e,"current-page":C.value,"onUpdate:currentPage":t[5]||=e=>C.value=e,small:!0,total:T.value,"page-sizes":[20,50,100,200,300],layout:`prev,pager, next, total`,onCurrentChange:t[6]||=e=>P(e,!0),onNextClick:t[7]||=()=>P(1),onPrevClick:t[8]||=()=>P(-1)},null,8,[`page-size`,`current-page`,`total`]),s(K,{modelValue:A.value,"onUpdate:modelValue":t[15]||=e=>A.value=e,"show-close":!1,title:M.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:`30%`,class:`new-item-dialog`},{footer:y(()=>[s(E,{type:`secondary`,onClick:t[13]||=e=>A.value=!1},{default:y(()=>[o(_(v(D)(`common.cancel`)),1)]),_:1}),s(E,{type:`primary`,onClick:t[14]||=e=>v(c).saveListItem()},{default:y(()=>t[16]||=[o(`Confirm`)]),_:1})]),default:y(()=>[s(G,{"label-width":`60px`},{default:y(()=>[v(u).type==`list`?(p(),r(W,{key:0,label:`Index`},{default:y(()=>[s(m,{modelValue:v(d).index,"onUpdate:modelValue":t[9]||=e=>v(d).index=e,size:`small`,disabled:``},null,8,[`modelValue`])]),_:1})):i(``,!0),v(u).type==`hash`?(p(),r(W,{key:1,label:`Field`},{default:y(()=>[s(m,{modelValue:v(d).key,"onUpdate:modelValue":t[10]||=e=>v(d).key=e,size:`small`},null,8,[`modelValue`])]),_:1})):i(``,!0),v(u).type==`zset`?(p(),r(W,{key:2,label:`Score`},{default:y(()=>[s(m,{modelValue:v(d).score,"onUpdate:modelValue":t[11]||=e=>v(d).score=e,size:`small`},null,8,[`modelValue`])]),_:1})):i(``,!0),s(W,{label:N.value},{default:y(()=>[s(m,{modelValue:v(d).value,"onUpdate:modelValue":t[12]||=e=>v(d).value=e,size:`small`},null,8,[`modelValue`])]),_:1},8,[`label`])]),_:1})]),_:1},8,[`modelValue`,`title`])]),n(`div`,null,[s(J,{data:B.value,height:v(f),border:``},{default:y(()=>[v(u).type==`list`?(p(),r(q,{key:0,label:`Index`,prop:`index`,sortable:``,width:`90`,align:`center`})):i(``,!0),v(u).type==`hash`?(p(),r(q,{key:1,"sort-by":`key`,resizable:``,sortable:``,label:`Field`,align:`center`,width:`200`,prop:`key`})):i(``,!0),v(u).type==`zset`?(p(),r(q,{key:2,"sort-by":`score`,resizable:``,sortable:``,label:`Score`,align:`center`,width:`200`,prop:`score`})):i(``,!0),v(u).type==`stream`?(p(),r(q,{key:3,"sort-by":`id`,resizable:``,sortable:``,label:`id`,align:`center`,width:`200`,prop:`id`})):i(``,!0),s(q,{"sort-by":`value`,resizable:``,sortable:``,label:N.value,align:`center`},{default:y(e=>{var t;return[n(`span`,{class:`item-value`,title:e.row.value,textContent:_((t=e.row)?.value||e.row)},null,8,te)]}),_:1},8,[`label`]),s(q,{label:`Operation`,width:`150`,align:`center`},{default:y(e=>[s(E,{type:`icon`,icon:`codicon-copy`,title:`View On Dialog`,onClick:t=>{H(e.row)}},null,8,[`onClick`]),[`list`,`hash`,`set`,`zset`].includes(v(u).type)?(p(),r(E,{key:0,type:`icon`,icon:`codicon-edit text-base`,title:`edit`,style:{color:`var(--vscode-terminal-ansiYellow)`},onClick:t=>U(e.row)},null,8,[`onClick`])):i(``,!0),s(E,{class:`ml-3`,type:`icon`,icon:`el-icon-delete text-base`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>V(e.row)},null,8,[`onClick`])]),_:1})]),_:1},8,[`data`,`height`])])])):i(``,!0)}}}),re=ne;function ie(e){if(e==null)return``;if(!Number.isFinite(e)&&(e=parseInt(e),!Number.isFinite(e)))return`${e}`;let t=e<0;t&&(e=-e);let n=[`B`,`K`,`M`,`G`,`T`,`P`,`E`,`Z`,`Y`];if(e<1)return`${t?`-`:``}${e} ${n[0]}`;let r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),n.length-1);e/=1024**r;let i=Number(e.toPrecision(3));return`${t?`-`:``}${i}${n[r]}`}const ae={key:0,id:`stringPanel`,class:`flex pr-4 mb-2 gap-x-3 items-center ml-1`},oe={key:0,class:`flex`},se={class:`value-panel`};var ce=c({__name:`RedisStringView`,setup(c){let f=J(),{key:S}=E(f),w=m(``),T=m(`Text`),D=m(q),O=t(()=>{var e;return ie((e=w.value)?.length||0)}),k=t(()=>[`string`,`ReJSON-RL`].includes(f.key.type));window.addEventListener(`keydown`,e=>{k.value&&u(e)&&e.code==`KeyS`&&j()});let j=()=>{if(!f.edit.name)return A(`Key name cannot be null!`);l.emit(`update`,{key:{name:f.key.name,newName:f.edit.name,type:f.key.type,ttl:f.edit.ttl,content:w.value}})};l.on(`detailNext`,()=>{M()});let M=()=>{if(!k.value)return w.value=``;let e=f.edit.content,t=e?.match(/^\s*[{[]/)!=null;T.value=t?`JSON`:`Text`,t?F(e):w.value=e},F=e=>{try{var t;w.value=W(U(e==null||(t=e.replace)==null?void 0:t.call(e,/Â /g,` `)),null,2)}catch(t){console.error(t),w.value=e}};return(t,c)=>{let u=N,m=P,E=g(`vsc-button`),k=g(`vsc-tooltip`),A=x;return p(),a(e,null,[[`string`,`ReJSON-RL`].includes(v(S).type)?(p(),a(`div`,ae,[n(`div`,null,` Size: `+_(O.value),1),[`string`,`ReJSON-RL`].includes(v(S).type)?(p(),a(`div`,oe,[s(m,{modelValue:T.value,"onUpdate:modelValue":c[0]||=e=>T.value=e,placeholder:`Default`,size:`small`,style:{width:`145px`},class:`mr-2`},{default:y(()=>[(p(!0),a(e,null,h(D.value,e=>(p(),r(u,{key:e,value:e},{default:y(()=>[o(_(e),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`modelValue`]),s(k,{title:t.$t(`common.refresh`),placement:`top`},{default:y(()=>[s(E,{type:`secondary`,size:`micro`,icon:`codicon-refresh`,onClick:c[1]||=e=>{v(l).emit(`refresh`)}})]),_:1},8,[`title`]),s(E,{icon:`codicon codicon-save`,style:{height:`27px`},onClick:j},{default:y(()=>c[3]||=[o(`Save`)]),_:1})])):i(``,!0)])):i(``,!0),b(s(A,null,{default:y(()=>[n(`div`,se,[s(K,{ref:`cmEditor`,value:w.value,"onUpdate:value":c[2]||=e=>w.value=e,language:T.value,class:`json-panel`,style:d(`height:`+v(f).remainHeight+`px`)},null,8,[`value`,`language`,`style`])])]),_:1},512),[[C,[`string`,`ReJSON-RL`].includes(v(S).type)]])],64)}}}),le=M(ce,[[`__scopeId`,`data-v-1ea839f2`]]);const ue={class:`redis-view-container`},de={key:0,style:{"text-align":`center`}},fe={class:`mx-2`};var pe=c({__name:`RedisView`,setup(e){let t=m(!0),r=J(),o=z();return f(()=>{H(100,[],e=>{r.remainHeight=e}),l.on(`new`,({prefix:e,stack:n})=>{t.value=!1,r.stack=n,r.key={name:e,type:B.STRING,ttl:-1},r.edit=G(r.key)}).on(`detail`,e=>{t.value=!1,r.key=e.res,r.edit=G(e.res),l.emitImmediately(`detailNext`)}).on(`error`,e=>{A(e)}).on(`success`,e=>{j(e)}),l.emit(`init`)}),(e,r)=>(p(),a(`div`,ue,[t.value?(p(),a(`div`,de,` loading `)):i(``,!0),b(n(`div`,fe,[s(Q),s(re),s(le)],512),[[C,!t.value]])]))}}),me=pe;export{me as default};